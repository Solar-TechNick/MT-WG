<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WireGuard MikroTik Configurator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="theme-toggle">
                <span class="theme-label">Light</span>
                <label class="theme-switch">
                    <input type="checkbox" id="themeToggle">
                    <span class="theme-slider"></span>
                </label>
                <span class="theme-label">Dark</span>
            </div>
            
            <h1>MikroTik RouterOS Configurator</h1>
            <p>Generate WireGuard VPN and LTE mobile configurations for MikroTik RouterOS</p>
            
            <nav class="main-nav">
                <button class="nav-button active" data-page="wireguard">
                    üîê WireGuard VPN
                </button>
                <button class="nav-button" data-page="lte">
                    üì° LTE Mobile
                </button>
                <button class="nav-button" data-page="about">
                    ‚ÑπÔ∏è About
                </button>
            </nav>
        </header>

        <main>
            <!-- WireGuard VPN Page -->
            <div class="page-content active" id="wireguard-page">
                <div class="config-selector">
                    <h2>Configuration Type</h2>
                    <div class="radio-group">
                        <div class="tooltip-container">
                            <label>
                                <input type="radio" name="configType" value="client-server" checked>
                                Client-Server Configuration
                            </label>
                            <button type="button" class="info-btn">?
                                <div class="tooltip">Traditional VPN setup with a central server and multiple client devices connecting to it</div>
                            </button>
                        </div>
                        <div class="tooltip-container">
                            <label>
                                <input type="radio" name="configType" value="site-to-site">
                                Site-to-Site Configuration
                            </label>
                            <button type="button" class="info-btn">?
                                <div class="tooltip">Connect multiple office locations or networks directly to each other</div>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="config-form">
                    <!-- Server Configuration Section -->
                    <div class="section" id="server-config">
                        <h3>Server Configuration</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="serverName">Server Name</label>
                                <input type="text" id="serverName" value="WireGuard Server" placeholder="Enter server name">
                            </div>
                            <div class="form-group">
                                <label for="serverIP">Server IP/CIDR</label>
                                <input type="text" id="serverIP" value="10.0.0.1/24" placeholder="e.g., 10.0.0.1/24">
                            </div>
                            <div class="form-group">
                                <label for="listenPort">Listen Port</label>
                                <input type="number" id="listenPort" value="51820" min="1" max="65535">
                            </div>
                            <div class="form-group">
                                <label for="publicEndpoint">Public Endpoint</label>
                                <input type="text" id="publicEndpoint" placeholder="your-server.com or IP address">
                            </div>
                        </div>
                        
                        <div class="key-section">
                            <h4>Server Keys 
                                <button type="button" id="toggleServerKeys" class="btn btn-small btn-secondary">Manual Input</button>
                            </h4>
                            <div id="serverKeysManual" class="hidden">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="serverPrivateKey">Server Private Key</label>
                                        <input type="text" id="serverPrivateKey" placeholder="Leave empty to auto-generate">
                                        <small>Base64 encoded private key</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="serverPublicKey">Server Public Key</label>
                                        <input type="text" id="serverPublicKey" placeholder="Will be derived from private key" readonly>
                                        <small>Automatically derived from private key</small>
                                    </div>
                                </div>
                            </div>
                            <div id="serverKeysAuto">
                                <p><small>üîë Server keys will be automatically generated. Click "Manual Input" to enter custom keys.</small></p>
                            </div>
                        </div>
                    </div>

                    <!-- Client Configuration Section -->
                    <div class="section" id="client-config">
                        <h3>Client Configuration</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="numClients">Number of Clients</label>
                                <input type="number" id="numClients" value="5" min="1" max="250">
                            </div>
                            <div class="form-group">
                                <label for="clientSubnet">Client Subnet</label>
                                <input type="text" id="clientSubnet" readonly>
                            </div>
                            <div class="form-group">
                                <label for="dnsServers">DNS Servers</label>
                                <input type="text" id="dnsServers" value="1.1.1.1, 8.8.8.8" placeholder="DNS servers">
                            </div>
                            <div class="form-group">
                                <label for="allowedIPs">Allowed IPs</label>
                                <input type="text" id="allowedIPs" value="0.0.0.0/0" placeholder="0.0.0.0/0 for full tunnel">
                            </div>
                        </div>
                        
                        <div class="key-section">
                            <h4>Client Keys & PSK Configuration 
                                <button type="button" id="toggleClientKeys" class="btn btn-small btn-secondary">Manage Keys</button>
                            </h4>
                            <div id="clientKeysManagement" class="hidden">
                                <div class="form-group checkbox-group">
                                    <label>
                                        <input type="checkbox" id="enableIndividualPSK">
                                        Enable individual Pre-Shared Keys per client
                                    </label>
                                </div>
                                <div id="clientKeysList"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Site-to-Site Configuration Section -->
                    <div class="section hidden" id="site-config">
                        <h3>Site-to-Site Configuration</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="numSites">Number of Sites</label>
                                <input type="number" id="numSites" value="2" min="2" max="10">
                            </div>
                            <div class="form-group">
                                <label for="transferSubnet">Transfer Subnet</label>
                                <input type="text" id="transferSubnet" value="10.2.2.0/24" placeholder="Transfer network">
                            </div>
                        </div>
                        <div id="sitesContainer">
                            <!-- Dynamic sites will be populated here -->
                        </div>
                    </div>

                    <!-- MikroTik RouterOS Settings -->
                    <div class="section">
                        <h3>MikroTik RouterOS Settings</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="interfaceName">WireGuard Interface Name</label>
                                <input type="text" id="interfaceName" value="wireguard1" placeholder="e.g., wireguard1">
                            </div>
                            <div class="form-group">
                                <label for="globalPSK">Global Pre-Shared Key</label>
                                <input type="text" id="globalPSK" placeholder="Leave empty to auto-generate or disable">
                            </div>
                            <div class="form-group">
                                <label for="localNetwork">Local Network (for sites)</label>
                                <input type="text" id="localNetwork" placeholder="e.g., 192.168.1.0/24">
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Options -->
                    <div class="section">
                        <h3>Advanced Options</h3>
                        <div class="form-grid">
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="enablePSK">
                                    Enable Pre-Shared Key
                                </label>
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="noRoutingTable">
                                    No Routing Table (VPN subnet only)
                                </label>
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="enableNAT" checked>
                                    Enable Masquerade/NAT
                                </label>
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="generateFirewall" checked>
                                    Generate Firewall Rules
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="mtu">MTU (Maximum Transmission Unit)</label>
                                <input type="number" id="mtu" value="1420" min="1280" max="1500">
                            </div>
                            <div class="form-group">
                                <label for="keepalive">Persistent Keepalive (seconds)</label>
                                <input type="number" id="keepalive" value="25" min="0" max="65535">
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="actions">
                        <div class="tooltip-container">
                            <button type="button" id="generateKeys" class="btn btn-secondary">Generate New Keys</button>
                            <button type="button" class="info-btn">?
                                <div class="tooltip">Generate new secure private/public key pairs for all servers and clients</div>
                            </button>
                        </div>
                        <div class="tooltip-container">
                            <button type="button" id="generateConfig" class="btn btn-primary">Generate Configuration</button>
                            <button type="button" class="info-btn">?
                                <div class="tooltip">Create WireGuard configuration files, MikroTik RouterOS scripts, and QR codes based on current settings</div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Output Section -->
                <div class="output-section hidden" id="outputSection">
                    <div class="tabs">
                        <div class="tooltip-container">
                            <button class="tab-button active" data-tab="wireguard">WireGuard & QR</button>
                            <button type="button" class="info-btn">?
                                <div class="tooltip">WireGuard configuration files and QR codes for mobile devices</div>
                            </button>
                        </div>
                        <div class="tooltip-container">
                            <button class="tab-button" data-tab="mikrotik">MikroTik Script</button>
                            <button type="button" class="info-btn">?
                                <div class="tooltip">Ready-to-use RouterOS commands for configuring WireGuard on MikroTik devices</div>
                            </button>
                        </div>
                        <div class="tooltip-container">
                            <button class="tab-button" data-tab="vyos">VyOS Script</button>
                            <button type="button" class="info-btn">?
                                <div class="tooltip">VyOS configuration commands for WireGuard setup with commit/save session</div>
                            </button>
                        </div>
                        <div class="tooltip-container">
                            <button class="tab-button" data-tab="opnsense">OPNsense Script</button>
                            <button type="button" class="info-btn">?
                                <div class="tooltip">OPNsense configuration with web GUI steps, CLI commands, and XML snippets</div>
                            </button>
                        </div>
                    </div>

                    <div class="tab-content active" id="wireguard-tab">
                        <h3>WireGuard Configuration Files</h3>
                        <div id="wireguardOutput"></div>
                        
                        <h3>QR Codes for Mobile Devices</h3>
                        <div id="qrOutput"></div>
                    </div>

                    <div class="tab-content" id="mikrotik-tab">
                        <h3>MikroTik RouterOS Scripts</h3>
                        <div id="mikrotikOutput"></div>
                    </div>

                    <div class="tab-content" id="vyos-tab">
                        <h3>VyOS Configuration Commands</h3>
                        <div id="vyosOutput"></div>
                    </div>

                    <div class="tab-content" id="opnsense-tab">
                        <h3>OPNsense Configuration</h3>
                        <div id="opnsenseOutput"></div>
                    </div>
                    
                    <div class="actions">
                        <button class="btn btn-success" onclick="app.copyAllConfigurations()">Copy All Configurations</button>
                        <button class="btn btn-secondary" onclick="app.downloadQRCodes()">Download QR Codes</button>
                        <button class="btn btn-warning" onclick="app.downloadAsPDF()">Download as PDF</button>
                    </div>
                </div>
            </div>

            <!-- LTE Mobile Page -->
            <div class="page-content" id="lte-page">
                <div class="config-selector">
                    <h2>LTE Mobile Configuration</h2>
                    <p>Configure MikroTik LTE interface for German mobile providers</p>
                </div>

                <div class="config-form">
                    <!-- Mobile Provider Settings -->
                    <div class="section">
                        <h3>Mobile Provider Settings</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="mobileProvider">Mobile Provider</label>
                                <select id="mobileProvider">
                                    <option value="custom">Custom Configuration</option>
                                    <optgroup label="Deutsche Telekom Network">
                                        <option value="telekom">Deutsche Telekom (Main)</option>
                                        <option value="telekom_alt">Deutsche Telekom (Alternative)</option>
                                        <option value="telekom_ipv6">Deutsche Telekom (IPv6 only)</option>
                                        <option value="congstar">congstar</option>
                                        <option value="mobilcom_debitel_telekom">mobilcom-debitel (Telekom)</option>
                                        <option value="klarmobil">klarmobil</option>
                                    </optgroup>
                                    <optgroup label="Vodafone Network">
                                        <option value="vodafone">Vodafone (Standard)</option>
                                        <option value="vodafone_gigacube">Vodafone GigaCube</option>
                                        <option value="1und1_vodafone">1&1 (Vodafone Network)</option>
                                        <option value="otelo">otelo</option>
                                        <option value="mobilcom_debitel_vodafone">mobilcom-debitel (Vodafone)</option>
                                    </optgroup>
                                    <optgroup label="O2 / Telef√≥nica Network">
                                        <option value="o2">O2 / Telef√≥nica (Contract)</option>
                                        <option value="o2_prepaid">O2 Prepaid</option>
                                        <option value="1und1_o2">1&1 (O2 Network - legacy)</option>
                                        <option value="aldi_talk">ALDI TALK</option>
                                        <option value="drillisch">Drillisch (winSIM, PremiumSIM)</option>
                                        <option value="freenet">freenet Mobile</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="apnName">APN Name</label>
                                <input type="text" id="apnName" placeholder="Automatically filled from provider">
                            </div>
                            <div class="form-group">
                                <label for="apnUsername">Username</label>
                                <input type="text" id="apnUsername" placeholder="Optional - leave empty if not required">
                            </div>
                            <div class="form-group">
                                <label for="apnPassword">Password</label>
                                <input type="text" id="apnPassword" placeholder="Optional - leave empty if not required">
                            </div>
                        </div>
                    </div>

                    <!-- SIM Card Settings -->
                    <div class="section">
                        <h3>SIM Card Settings</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="simPin">SIM PIN</label>
                                <input type="password" id="simPin" placeholder="Enter SIM card PIN (usually 4 digits)">
                            </div>
                            <div class="form-group">
                                <label for="lteInterface">LTE Interface</label>
                                <input type="text" id="lteInterface" value="lte1" placeholder="e.g., lte1">
                            </div>
                            <div class="form-group">
                                <label for="apnProfileName">APN Profile Name</label>
                                <input type="text" id="apnProfileName" placeholder="e.g., provider-profile">
                            </div>
                        </div>
                    </div>

                    <!-- Advanced LTE Settings -->
                    <div class="section">
                        <h3>Advanced LTE Settings</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="authMethod">Authentication Method</label>
                                <select id="authMethod">
                                    <option value="none">None</option>
                                    <option value="pap">PAP</option>
                                    <option value="chap" selected>CHAP</option>
                                    <option value="pap-chap">PAP and CHAP</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="ipType">IP Type</label>
                                <select id="ipType">
                                    <option value="ipv4" selected>IPv4 only</option>
                                    <option value="ipv6">IPv6 only</option>
                                    <option value="ipv4v6">IPv4 and IPv6 (Dual Stack)</option>
                                </select>
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="enableLteNat" checked>
                                    Enable NAT for LTE
                                </label>
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="enableLteFirewall" checked>
                                    Generate Firewall Rules
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Network Configuration -->
                    <div class="section">
                        <h3>Network Configuration</h3>
                        <div class="form-grid">
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="setDefaultRoute" checked>
                                    Set as Default Route
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="routeDistance">Route Distance</label>
                                <input type="number" id="routeDistance" value="1" min="1" max="255">
                            </div>
                            <div class="form-group">
                                <label for="localLanNetwork">Local LAN Network</label>
                                <input type="text" id="localLanNetwork" value="192.168.1.0/24" placeholder="e.g., 192.168.1.0/24">
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="enableLteDns" checked>
                                    Configure DNS Servers
                                    <span class="tooltip">
                                        <span class="tooltiptext">Automatically configure DNS servers for reliable internet access</span>
                                    </span>
                                </label>
                            </div>
                            <div class="form-group" id="dnsServersGroup">
                                <label for="lteDnsServers">DNS Servers</label>
                                <input type="text" id="lteDnsServers" value="8.8.8.8, 1.1.1.1" placeholder="e.g., 8.8.8.8, 1.1.1.1">
                                <small>Comma-separated list of DNS server IPs</small>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="actions">
                        <div class="tooltip-container">
                            <button type="button" id="generateLteConfig" class="btn btn-primary">Generate LTE Configuration</button>
                            <button type="button" class="info-btn">?
                                <div class="tooltip">Generate MikroTik RouterOS script for LTE configuration with your selected provider settings</div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- LTE Output Section -->
                <div class="output-section hidden" id="lteOutputSection">
                    <div class="tabs">
                        <div class="tooltip-container">
                            <button class="tab-button active" data-tab="lte-script">RouterOS Script</button>
                            <button type="button" class="info-btn">?
                                <div class="tooltip">Complete MikroTik RouterOS script ready to copy and paste into your router</div>
                            </button>
                        </div>
                    </div>

                    <div class="tab-content active" id="lte-script-tab">
                        <h3>MikroTik RouterOS LTE Configuration Script</h3>
                        <div id="lteScriptOutput"></div>
                    </div>
                </div>
            </div>

            <!-- About Page -->
            <div class="page-content" id="about-page">
                <div class="section">
                    <h2>About WireGuard MikroTik Configurator</h2>
                    <p>This modern, professional tool helps you generate secure WireGuard VPN configurations and LTE mobile settings specifically optimized for MikroTik RouterOS devices.</p>
                    
                    <h3>Features</h3>
                    <ul>
                        <li>üîê <strong>Secure WireGuard VPN</strong> - Generate client-server and site-to-site configurations</li>
                        <li>üì° <strong>LTE Mobile Support</strong> - Pre-configured settings for German mobile providers</li>
                        <li>üé® <strong>Modern Dark/Light Theme</strong> - Professional corporate design</li>
                        <li>üì± <strong>QR Code Generation</strong> - Easy mobile device setup</li>
                        <li>üìã <strong>Copy & Download</strong> - Export configurations as files or PDF</li>
                        <li>üîß <strong>MikroTik Optimized</strong> - Ready-to-use RouterOS scripts</li>
                    </ul>

                    <h3>Security</h3>
                    <p>All cryptographic operations are performed locally in your browser using the WebCrypto API. No keys or configurations are transmitted to external servers.</p>

                    <h3>Version Information</h3>
                    <p><strong>Version:</strong> 2.0.0 (Modern Redesign)</p>
                    <p><strong>Updated:</strong> 2025</p>
                    <p><strong>License:</strong> Open Source</p>
                </div>
            </div>
        </main>
    </div>

    <!-- External Libraries -->
    <script src="https://unpkg.com/qrcode-generator@1.4.4/qrcode.js"></script>
    <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="demo/qr-offline.js"></script>
    
    <!-- QR Code Setup -->
    <script>
        // QR Code wrapper to use qrcode-generator library
        window.QRCodeWrapper = {
            toCanvas: function(canvas, text, options) {
                return new Promise((resolve, reject) => {
                    try {
                        const qr = qrcode(0, 'M');
                        qr.addData(text);
                        qr.make();
                        
                        const cellSize = Math.floor((options.width || 200) / qr.getModuleCount());
                        const size = cellSize * qr.getModuleCount();
                        
                        canvas.width = size;
                        canvas.height = size;
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Clear background
                        ctx.fillStyle = options.color?.light || '#FFFFFF';
                        ctx.fillRect(0, 0, size, size);
                        
                        // Draw QR code
                        ctx.fillStyle = options.color?.dark || '#000000';
                        
                        for (let row = 0; row < qr.getModuleCount(); row++) {
                            for (let col = 0; col < qr.getModuleCount(); col++) {
                                if (qr.isDark(row, col)) {
                                    ctx.fillRect(col * cellSize, row * cellSize, cellSize, cellSize);
                                }
                            }
                        }
                        
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                });
            }
        };
        
        // Check if qrcode-generator loaded, otherwise use offline version
        window.addEventListener('load', function() {
            if (typeof qrcode !== 'undefined') {
                console.log('Using qrcode-generator library');
                window.QRCode = window.QRCodeWrapper;
            } else if (typeof window.SimpleQRCode !== 'undefined') {
                console.warn('QR library not loaded, using offline SimpleQRCode');
                window.QRCode = window.SimpleQRCode;
            } else {
                console.error('No QR code library available');
            }
        });
    </script>
    
    <!-- Application Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/crypto.js"></script>
    <script src="js/wireguard.js"></script>
    <script src="js/vyos.js"></script>
    <script src="js/opnsense.js"></script>
    <script src="js/lte.js"></script>
    <script src="js/app.js"></script>
</body>
</html>