<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WireGuard MikroTik Configurator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>MikroTik RouterOS Configurator</h1>
            <p>Generate WireGuard and LTE configurations for MikroTik RouterOS</p>
            
            <nav class="main-nav">
                <button class="nav-button active" data-page="wireguard">üîê WireGuard VPN</button>
                <button class="nav-button" data-page="lte">üì° LTE Mobile</button>
            </nav>
        </header>

        <main>
            <div class="page-content active" id="wireguard-page">
            <div class="config-selector">
                <h2>Configuration Type</h2>
                <div class="radio-group">
                    <div class="tooltip-container">
                        <label>
                            <input type="radio" name="configType" value="client-server" checked>
                            Client-Server Configuration
                        </label>
                        <button type="button" class="info-btn">?
                            <div class="tooltip">Traditional VPN setup with a central server and multiple client devices connecting to it</div>
                        </button>
                    </div>
                    <div class="tooltip-container">
                        <label>
                            <input type="radio" name="configType" value="site-to-site">
                            Site-to-Site Configuration
                        </label>
                        <button type="button" class="info-btn">?
                            <div class="tooltip">Connect multiple office locations or networks directly to each other</div>
                        </button>
                    </div>
                </div>
            </div>

            <div class="config-form">
                <div class="section" id="server-config">
                    <h3>Server Configuration</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="serverName">Server Name:</label>
                            <input type="text" id="serverName" value="WireGuard Server" placeholder="Enter server name">
                        </div>
                        <div class="form-group">
                            <label for="serverIP">Server IP/CIDR:</label>
                            <input type="text" id="serverIP" value="10.0.0.1/24" placeholder="e.g., 10.0.0.1/24">
                        </div>
                        <div class="form-group">
                            <label for="listenPort">Listen Port:</label>
                            <input type="number" id="listenPort" value="51820" min="1" max="65535">
                        </div>
                        <div class="form-group">
                            <label for="publicEndpoint">Public Endpoint:</label>
                            <input type="text" id="publicEndpoint" placeholder="your-server.com or IP address">
                        </div>
                    </div>
                    
                    <div class="key-section">
                        <h4>Server Keys <button type="button" id="toggleServerKeys" class="btn-small">Manual Input</button></h4>
                        <div id="serverKeysManual" style="display: none;">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="serverPrivateKey">Server Private Key:</label>
                                    <input type="text" id="serverPrivateKey" placeholder="Leave empty to auto-generate">
                                    <small>Base64 encoded private key</small>
                                </div>
                                <div class="form-group">
                                    <label for="serverPublicKey">Server Public Key:</label>
                                    <input type="text" id="serverPublicKey" placeholder="Will be derived from private key" readonly>
                                    <small>Automatically derived from private key</small>
                                </div>
                            </div>
                        </div>
                        <div id="serverKeysAuto">
                            <p><small>üîë Server keys will be automatically generated. Click "Manual Input" to enter custom keys.</small></p>
                        </div>
                    </div>
                </div>

                <div class="section" id="client-config">
                    <h3>Client Configuration</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="numClients">Number of Clients:</label>
                            <input type="number" id="numClients" value="5" min="1" max="250">
                        </div>
                        <div class="form-group">
                            <label for="clientSubnet">Client Subnet:</label>
                            <input type="text" id="clientSubnet" readonly>
                        </div>
                        <div class="form-group">
                            <label for="dnsServers">DNS Servers:</label>
                            <input type="text" id="dnsServers" value="1.1.1.1, 8.8.8.8" placeholder="DNS servers">
                        </div>
                        <div class="form-group">
                            <label for="allowedIPs">Allowed IPs:</label>
                            <input type="text" id="allowedIPs" value="0.0.0.0/0" placeholder="0.0.0.0/0 for full tunnel">
                        </div>
                    </div>
                    
                    <div class="key-section">
                        <h4>Client Keys & PSK Configuration <button type="button" id="toggleClientKeys" class="btn-small">Manage Keys</button></h4>
                        <div id="clientKeysManagement" style="display: none;">
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="enableIndividualPSK">
                                    Enable individual Pre-Shared Keys per client
                                </label>
                            </div>
                            <div id="clientKeysList"></div>
                        </div>
                    </div>
                </div>

                <div class="section" id="site-config" style="display: none;">
                    <h3>Site-to-Site Configuration</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="numSites">Number of Sites:</label>
                            <input type="number" id="numSites" value="2" min="2" max="10">
                        </div>
                        <div class="form-group">
                            <label for="transferSubnet">Transfer Subnet:</label>
                            <input type="text" id="transferSubnet" value="10.2.2.0/24" placeholder="Transfer network">
                        </div>
                    </div>
                    <div id="sitesContainer"></div>
                </div>

                <div class="section">
                    <h3>MikroTik RouterOS Settings</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="interfaceName">WireGuard Interface Name:</label>
                            <input type="text" id="interfaceName" value="wireguard1" placeholder="e.g., wireguard1">
                        </div>
                        <div class="form-group">
                            <label for="globalPSK">Global Pre-Shared Key:</label>
                            <input type="text" id="globalPSK" placeholder="Leave empty to auto-generate or disable">
                        </div>
                        <div class="form-group">
                            <label for="localNetwork">Local Network (for sites):</label>
                            <input type="text" id="localNetwork" placeholder="e.g., 192.168.1.0/24">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Advanced Options</h3>
                    <div class="form-grid">
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="enablePSK">
                                Enable Pre-Shared Key
                            </label>
                        </div>
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="noRoutingTable">
                                No Routing Table (VPN subnet only)
                            </label>
                        </div>
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="enableNAT" checked>
                                Enable Masquerade/NAT
                            </label>
                        </div>
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="generateFirewall" checked>
                                Generate Firewall Rules
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="mtu">MTU (Maximum Transmission Unit):</label>
                            <input type="number" id="mtu" value="1420" min="1280" max="1500">
                        </div>
                        <div class="form-group">
                            <label for="keepalive">Persistent Keepalive (seconds):</label>
                            <input type="number" id="keepalive" value="25" min="0" max="65535">
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <div class="tooltip-container">
                        <button type="button" id="generateKeys" class="btn btn-secondary">Generate New Keys</button>
                        <button type="button" class="info-btn">?
                            <div class="tooltip">Generate new secure private/public key pairs for all servers and clients</div>
                        </button>
                    </div>
                    <div class="tooltip-container">
                        <button type="button" id="generateConfig" class="btn btn-primary">Generate Configuration</button>
                        <button type="button" class="info-btn">?
                            <div class="tooltip">Create WireGuard configuration files, MikroTik RouterOS scripts, and QR codes based on current settings</div>
                        </button>
                    </div>
                </div>
            </div>

            <div class="output-section" id="outputSection" style="display: none;">
                <div class="tabs">
                    <div class="tooltip-container">
                        <button class="tab-button active" data-tab="wireguard">WireGuard Config</button>
                        <button type="button" class="info-btn">?
                            <div class="tooltip">Standard WireGuard configuration files that can be imported into any WireGuard client</div>
                        </button>
                    </div>
                    <div class="tooltip-container">
                        <button class="tab-button" data-tab="mikrotik">MikroTik Script</button>
                        <button type="button" class="info-btn">?
                            <div class="tooltip">Ready-to-use RouterOS commands for configuring WireGuard on MikroTik devices</div>
                        </button>
                    </div>
                    <div class="tooltip-container">
                        <button class="tab-button" data-tab="qr">QR Codes</button>
                        <button type="button" class="info-btn">?
                            <div class="tooltip">QR codes for easy mobile device configuration - scan with WireGuard mobile app</div>
                        </button>
                    </div>
                </div>

                <div class="tab-content active" id="wireguard-tab">
                    <h3>WireGuard Configuration Files</h3>
                    <div id="wireguardOutput"></div>
                </div>

                <div class="tab-content" id="mikrotik-tab">
                    <h3>MikroTik RouterOS Scripts</h3>
                    <div id="mikrotikOutput"></div>
                </div>

                <div class="tab-content" id="qr-tab">
                    <h3>QR Codes for Mobile Devices</h3>
                    <div id="qrOutput"></div>
                </div>
            </div>
            </div>

            <div class="page-content" id="lte-page">
                <div class="config-selector">
                    <h2>LTE Mobile Configuration</h2>
                    <p>Configure MikroTik LTE interface for German mobile providers</p>
                </div>

                <div class="config-form">
                    <div class="section">
                        <h3>Mobile Provider Settings</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="mobileProvider">Mobile Provider:</label>
                                <select id="mobileProvider">
                                    <option value="custom">Custom Configuration</option>
                                    <optgroup label="Deutsche Telekom Network">
                                        <option value="telekom">Deutsche Telekom (Main)</option>
                                        <option value="telekom_alt">Deutsche Telekom (Alternative)</option>
                                        <option value="telekom_ipv6">Deutsche Telekom (IPv6 only)</option>
                                        <option value="congstar">congstar</option>
                                        <option value="mobilcom_debitel_telekom">mobilcom-debitel (Telekom)</option>
                                        <option value="klarmobil">klarmobil</option>
                                    </optgroup>
                                    <optgroup label="Vodafone Network">
                                        <option value="vodafone">Vodafone (Standard)</option>
                                        <option value="vodafone_gigacube">Vodafone GigaCube</option>
                                        <option value="1und1_vodafone">1&1 (Vodafone Network)</option>
                                        <option value="otelo">otelo</option>
                                        <option value="mobilcom_debitel_vodafone">mobilcom-debitel (Vodafone)</option>
                                    </optgroup>
                                    <optgroup label="O2 / Telef√≥nica Network">
                                        <option value="o2">O2 / Telef√≥nica (Contract)</option>
                                        <option value="o2_prepaid">O2 Prepaid</option>
                                        <option value="1und1_o2">1&1 (O2 Network - legacy)</option>
                                        <option value="aldi_talk">ALDI TALK</option>
                                        <option value="drillisch">Drillisch (winSIM, PremiumSIM)</option>
                                        <option value="freenet">freenet Mobile</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="apnName">APN Name:</label>
                                <input type="text" id="apnName" placeholder="Automatically filled from provider">
                            </div>
                            <div class="form-group">
                                <label for="apnUsername">Username:</label>
                                <input type="text" id="apnUsername" placeholder="Optional - leave empty if not required">
                            </div>
                            <div class="form-group">
                                <label for="apnPassword">Password:</label>
                                <input type="text" id="apnPassword" placeholder="Optional - leave empty if not required">
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>SIM Card Settings</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="simPin">SIM PIN:</label>
                                <input type="password" id="simPin" placeholder="Enter SIM card PIN (usually 4 digits)">
                            </div>
                            <div class="form-group">
                                <label for="lteInterface">LTE Interface:</label>
                                <input type="text" id="lteInterface" value="lte1" placeholder="e.g., lte1">
                            </div>
                            <div class="form-group">
                                <label for="apnProfileName">APN Profile Name:</label>
                                <input type="text" id="apnProfileName" placeholder="e.g., provider-profile">
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Advanced LTE Settings</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="authMethod">Authentication Method:</label>
                                <select id="authMethod">
                                    <option value="none">None</option>
                                    <option value="pap">PAP</option>
                                    <option value="chap" selected>CHAP</option>
                                    <option value="pap-chap">PAP and CHAP</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="ipType">IP Type:</label>
                                <select id="ipType">
                                    <option value="ipv4" selected>IPv4 only</option>
                                    <option value="ipv6">IPv6 only</option>
                                    <option value="ipv4v6">IPv4 and IPv6 (Dual Stack)</option>
                                </select>
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="enableLteNat" checked>
                                    Enable NAT for LTE
                                </label>
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="enableLteFirewall" checked>
                                    Generate Firewall Rules
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Network Configuration</h3>
                        <div class="form-grid">
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="setDefaultRoute" checked>
                                    Set as Default Route
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="routeDistance">Route Distance:</label>
                                <input type="number" id="routeDistance" value="1" min="1" max="255">
                            </div>
                            <div class="form-group">
                                <label for="localLanNetwork">Local LAN Network:</label>
                                <input type="text" id="localLanNetwork" value="192.168.1.0/24" placeholder="e.g., 192.168.1.0/24">
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Multiple APN Profiles</h3>
                        <div class="form-grid">
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="enableMultipleApn">
                                    Enable Multiple APN Profiles
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="additionalProviders">Additional Providers:</label>
                                <div id="additionalProvidersContainer" style="display: none;">
                                    <button type="button" id="addProviderBtn" class="btn btn-secondary" style="margin-bottom: 15px;">+ Add Provider</button>
                                    <div id="additionalProvidersList"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="actions">
                        <div class="tooltip-container">
                            <button type="button" id="generateLteConfig" class="btn btn-primary">Generate LTE Configuration</button>
                            <button type="button" class="info-btn">?
                                <div class="tooltip">Generate MikroTik RouterOS script for LTE configuration with your selected provider settings</div>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="output-section" id="lteOutputSection" style="display: none;">
                    <div class="tabs">
                        <div class="tooltip-container">
                            <button class="tab-button active" data-tab="lte-script">RouterOS Script</button>
                            <button type="button" class="info-btn">?
                                <div class="tooltip">Complete MikroTik RouterOS script ready to copy and paste into your router</div>
                            </button>
                        </div>
                    </div>

                    <div class="tab-content active" id="lte-script-tab">
                        <h3>MikroTik RouterOS LTE Configuration Script</h3>
                        <div id="lteScriptOutput"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://unpkg.com/qrcode-generator@1.4.4/qrcode.js"></script>
    <script src="qr-offline.js"></script>
    <script>
        // QR Code wrapper to use qrcode-generator library
        window.QRCodeWrapper = {
            toCanvas: function(canvas, text, options) {
                return new Promise((resolve, reject) => {
                    try {
                        const qr = qrcode(0, 'M');
                        qr.addData(text);
                        qr.make();
                        
                        const cellSize = Math.floor((options.width || 200) / qr.getModuleCount());
                        const size = cellSize * qr.getModuleCount();
                        
                        canvas.width = size;
                        canvas.height = size;
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Clear background
                        ctx.fillStyle = options.color?.light || '#FFFFFF';
                        ctx.fillRect(0, 0, size, size);
                        
                        // Draw QR code
                        ctx.fillStyle = options.color?.dark || '#000000';
                        
                        for (let row = 0; row < qr.getModuleCount(); row++) {
                            for (let col = 0; col < qr.getModuleCount(); col++) {
                                if (qr.isDark(row, col)) {
                                    ctx.fillRect(col * cellSize, row * cellSize, cellSize, cellSize);
                                }
                            }
                        }
                        
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                });
            }
        };
        
        // Check if qrcode-generator loaded, otherwise use offline version
        window.addEventListener('load', function() {
            if (typeof qrcode !== 'undefined') {
                console.log('Using qrcode-generator library');
                window.QRCode = window.QRCodeWrapper;
            } else if (typeof window.SimpleQRCode !== 'undefined') {
                console.warn('QR library not loaded, using offline SimpleQRCode');
                window.QRCode = window.SimpleQRCode;
            } else {
                console.error('No QR code library available');
            }
        });
    </script>
    <script src="script.js"></script>
</body>
</html>