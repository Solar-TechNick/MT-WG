<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LTE Button Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .btn { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        .status { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
    </style>
</head>
<body>
    <h1>LTE Configuration Button Test</h1>
    
    <div class="test-section">
        <h2>Element Verification</h2>
        <div id="elementStatus"></div>
    </div>
    
    <div class="test-section">
        <h2>Mock LTE Form</h2>
        <div>
            <label>Mobile Provider:</label>
            <select id="mobileProvider">
                <option value="telekom">Deutsche Telekom</option>
                <option value="vodafone">Vodafone</option>
            </select>
        </div>
        <div>
            <label>APN Name:</label>
            <input type="text" id="apnName" value="internet.telekom">
        </div>
        <div>
            <label>Username:</label>
            <input type="text" id="apnUsername" value="telekom">
        </div>
        <div>
            <label>Password:</label>
            <input type="text" id="apnPassword" value="tm">
        </div>
        <div>
            <label>SIM PIN:</label>
            <input type="text" id="simPin" value="1234">
        </div>
        <div>
            <label>LTE Interface:</label>
            <input type="text" id="lteInterface" value="lte1">
        </div>
        <div>
            <label>APN Profile Name:</label>
            <input type="text" id="apnProfileName" value="telekom-main">
        </div>
        <div>
            <label>Auth Method:</label>
            <select id="authMethod">
                <option value="chap">CHAP</option>
                <option value="pap">PAP</option>
            </select>
        </div>
        <div>
            <label>IP Type:</label>
            <select id="ipType">
                <option value="ipv4v6">IPv4 and IPv6</option>
                <option value="ipv4">IPv4 only</option>
            </select>
        </div>
        <div>
            <label><input type="checkbox" id="enableLteNat" checked> Enable LTE NAT</label>
        </div>
        <div>
            <label><input type="checkbox" id="enableLteFirewall" checked> Enable LTE Firewall</label>
        </div>
        <div>
            <label><input type="checkbox" id="setDefaultRoute" checked> Set Default Route</label>
        </div>
        <div>
            <label>Route Distance:</label>
            <input type="number" id="routeDistance" value="1">
        </div>
        <div>
            <label>Local LAN Network:</label>
            <input type="text" id="localLanNetwork" value="192.168.1.0/24">
        </div>
        <div>
            <label><input type="checkbox" id="enableMultipleApn"> Enable Multiple APN</label>
        </div>
        
        <br><br>
        <button type="button" id="generateLteConfig" class="btn">Generate LTE Configuration</button>
        <button type="button" id="testButton" class="btn">Test Button</button>
    </div>
    
    <div class="test-section">
        <h2>Generated Output</h2>
        <div id="lteScriptOutput"></div>
    </div>
    
    <div class="test-section">
        <h2>Log Output</h2>
        <div id="logOutput" style="font-family: monospace; white-space: pre-wrap; background: #f8f9fa; padding: 10px; border-radius: 3px;"></div>
    </div>

    <script>
        // Mock the WireGuardConfigurator class with minimal LTE functionality
        class TestConfigurator {
            constructor() {
                this.elements = {};
                this.additionalApnProfiles = [];
                this.lteProviders = {
                    telekom: {
                        name: 'Deutsche Telekom',
                        apn: 'internet.telekom',
                        username: 'telekom',
                        password: 'tm',
                        authMethod: 'chap',
                        ipType: 'ipv4v6',
                        profileName: 'telekom-main'
                    },
                    vodafone: {
                        name: 'Vodafone',
                        apn: 'web.vodafone.de',
                        username: '',
                        password: '',
                        authMethod: 'chap',
                        ipType: 'ipv4v6',
                        profileName: 'vodafone-main'
                    }
                };
                
                this.initializeElements();
                this.attachEventListeners();
                this.verifyElements();
            }
            
            log(message) {
                console.log(message);
                const logOutput = document.getElementById('logOutput');
                logOutput.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
                logOutput.scrollTop = logOutput.scrollHeight;
            }
            
            initializeElements() {
                const elementIds = [
                    'mobileProvider', 'apnName', 'apnUsername', 'apnPassword', 'simPin',
                    'lteInterface', 'apnProfileName', 'authMethod', 'ipType', 
                    'enableLteNat', 'enableLteFirewall', 'setDefaultRoute', 
                    'routeDistance', 'localLanNetwork', 'enableMultipleApn',
                    'generateLteConfig', 'lteScriptOutput'
                ];
                
                elementIds.forEach(id => {
                    this.elements[id] = document.getElementById(id);
                });
                
                this.log('Elements initialized');
            }
            
            verifyElements() {
                const statusDiv = document.getElementById('elementStatus');
                let html = '';
                
                Object.keys(this.elements).forEach(key => {
                    const element = this.elements[key];
                    const status = element ? 'Found' : 'Missing';
                    const statusClass = element ? 'success' : 'error';
                    html += `<div class="status ${statusClass}">${key}: ${status}</div>`;
                });
                
                statusDiv.innerHTML = html;
                this.log('Element verification complete');
            }
            
            attachEventListeners() {
                if (this.elements.generateLteConfig) {
                    this.elements.generateLteConfig.addEventListener('click', () => {
                        this.log('LTE Generate button clicked');
                        try {
                            this.generateLteConfiguration();
                        } catch (error) {
                            this.log('Error in generateLteConfiguration: ' + error.message);
                            console.error('Error:', error);
                        }
                    });
                    this.log('LTE button event listener attached');
                } else {
                    this.log('ERROR: generateLteConfig element not found');
                }
                
                // Test button
                const testButton = document.getElementById('testButton');
                if (testButton) {
                    testButton.addEventListener('click', () => {
                        this.log('Test button clicked - working!');
                    });
                }
            }
            
            generateLteConfiguration() {
                this.log('generateLteConfiguration called');
                
                // Check elements
                const provider = this.elements.mobileProvider?.value || 'unknown';
                const apnName = this.elements.apnName?.value?.trim() || '';
                
                this.log(`Provider: ${provider}, APN: ${apnName}`);
                
                if (!apnName) {
                    alert('Please enter an APN name.');
                    return;
                }
                
                // Create mock configuration
                const config = {
                    apnProfiles: [{
                        provider: provider,
                        apnName: apnName,
                        username: this.elements.apnUsername?.value?.trim() || '',
                        password: this.elements.apnPassword?.value?.trim() || '',
                        profileName: this.elements.apnProfileName?.value?.trim() || 'default',
                        authMethod: this.elements.authMethod?.value || 'chap',
                        ipType: this.elements.ipType?.value || 'ipv4',
                        isMain: true
                    }],
                    simPin: this.elements.simPin?.value?.trim() || '',
                    lteInterface: this.elements.lteInterface?.value?.trim() || 'lte1',
                    enableLteNat: this.elements.enableLteNat?.checked || false,
                    enableLteFirewall: this.elements.enableLteFirewall?.checked || false,
                    setDefaultRoute: this.elements.setDefaultRoute?.checked || false,
                    routeDistance: this.elements.routeDistance?.value || '1',
                    localLanNetwork: this.elements.localLanNetwork?.value?.trim() || ''
                };
                
                this.log('Configuration created: ' + JSON.stringify(config, null, 2));
                
                // Generate script
                const script = this.createLteScript(config);
                
                // Display script
                const output = this.elements.lteScriptOutput;
                if (output) {
                    output.innerHTML = `
                        <h4>Generated LTE Script</h4>
                        <textarea style="width: 100%; height: 300px; font-family: monospace;">${script}</textarea>
                        <button onclick="navigator.clipboard.writeText(\`${script.replace(/`/g, '\\`')}\`)">Copy Script</button>
                    `;
                    this.log('Script displayed successfully');
                } else {
                    this.log('ERROR: lteScriptOutput element not found');
                }
            }
            
            createLteScript(config) {
                const mainProfile = config.apnProfiles[0];
                const providerName = this.lteProviders[mainProfile.provider]?.name || 'Custom Provider';
                
                let script = '# MikroTik RouterOS LTE Configuration Script (Test)\n';
                script += `# Provider: ${providerName}\n`;
                script += `# APN: ${mainProfile.apnName}\n`;
                script += `# Interface: ${config.lteInterface}\n`;
                script += `# Generated: ${new Date().toLocaleDateString()}\n\n`;
                
                if (config.simPin) {
                    script += '# Configure SIM PIN\n';
                    script += `/interface/lte/set [find] pin="${config.simPin}"\n\n`;
                }
                
                script += '# Create APN profile\n';
                script += `/interface/lte/apn add name="${mainProfile.profileName}" `;
                script += `apn="${mainProfile.apnName}" `;
                
                if (mainProfile.username) {
                    script += `user="${mainProfile.username}" `;
                }
                if (mainProfile.password) {
                    script += `password="${mainProfile.password}" `;
                }
                
                script += `authentication=${mainProfile.authMethod} `;
                script += `ip-type=${mainProfile.ipType}\n\n`;
                
                script += '# Configure LTE interface\n';
                script += `/interface/lte/set [find] apn-profiles="${mainProfile.profileName}" `;
                script += `name="${config.lteInterface}"\n\n`;
                
                script += '# Enable LTE interface\n';
                script += `/interface/enable ${config.lteInterface}\n\n`;
                
                if (config.setDefaultRoute) {
                    script += '# Configure default route\n';
                    script += `/ip/route/add dst-address=0.0.0.0/0 gateway=${config.lteInterface} `;
                    script += `distance=${config.routeDistance} comment="LTE default route"\n\n`;
                }
                
                script += '# Configuration complete!\n';
                
                return script;
            }
        }
        
        // Initialize test configurator when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.testConfigurator = new TestConfigurator();
        });
    </script>
</body>
</html>