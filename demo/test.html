<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WireGuard Configurator Test</title>
</head>
<body>
    <h1>WireGuard Configurator Test</h1>
    <div id="test-results"></div>
    
    <script>
        // Simple test for key generation functionality
        class TestWireGuard {
            constructor() {
                this.runTests();
            }
            
            generatePrivateKey() {
                const array = new Uint8Array(32);
                crypto.getRandomValues(array);
                
                array[0] &= 248;
                array[31] &= 127;
                array[31] |= 64;
                
                return this.base64Encode(array);
            }
            
            base64Encode(bytes) {
                return btoa(String.fromCharCode(...bytes));
            }
            
            calculateSubnet(totalHosts, serverIP) {
                const [ip, currentCidr] = serverIP.split('/');
                
                const requiredBits = Math.ceil(Math.log2(totalHosts + 2));
                const hostBits = Math.max(requiredBits, 32 - parseInt(currentCidr || 24));
                const newCidr = 32 - hostBits;
                
                const ipParts = ip.split('.').map(Number);
                const networkAddr = this.getNetworkAddress(ipParts, newCidr);
                
                return `${networkAddr.join('.')}/${newCidr}`;
            }
            
            getNetworkAddress(ipParts, cidr) {
                const hostBits = 32 - cidr;
                const mask = (0xFFFFFFFF << hostBits) >>> 0;
                
                const ipNum = (ipParts[0] << 24) + (ipParts[1] << 16) + (ipParts[2] << 8) + ipParts[3];
                const networkNum = (ipNum & mask) >>> 0;
                
                return [
                    (networkNum >>> 24) & 0xFF,
                    (networkNum >>> 16) & 0xFF,
                    (networkNum >>> 8) & 0xFF,
                    networkNum & 0xFF
                ];
            }
            
            runTests() {
                const results = document.getElementById('test-results');
                let output = '<h2>Test Results</h2>';
                
                try {
                    // Test 1: Key Generation
                    const privateKey = this.generatePrivateKey();
                    output += `<p>✅ Private Key Generated: ${privateKey.substring(0, 20)}...</p>`;
                    
                    // Test 2: Subnet Calculation
                    const subnet = this.calculateSubnet(5, '10.0.0.1/24');
                    output += `<p>✅ Subnet Calculation (5 hosts): ${subnet}</p>`;
                    
                    // Test 3: Multiple subnet sizes
                    const subnet10 = this.calculateSubnet(10, '10.0.0.1/24');
                    const subnet50 = this.calculateSubnet(50, '10.0.0.1/24');
                    output += `<p>✅ Subnet for 10 hosts: ${subnet10}</p>`;
                    output += `<p>✅ Subnet for 50 hosts: ${subnet50}</p>`;
                    
                    // Test 4: Network Address Calculation
                    const networkAddr = this.getNetworkAddress([192, 168, 1, 100], 24);
                    output += `<p>✅ Network Address: ${networkAddr.join('.')}</p>`;
                    
                    output += '<p><strong>All tests passed! ✅</strong></p>';
                    
                } catch (error) {
                    output += `<p>❌ Test failed: ${error.message}</p>`;
                }
                
                results.innerHTML = output;
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            new TestWireGuard();
        });
    </script>
</body>
</html>